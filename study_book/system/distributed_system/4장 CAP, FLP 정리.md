# 4장. CAP, FLP 정리

Owner: 임정한

# 4.1 복제 시 발생하는 네트워크 장애

## 내용

### 비일관성 문제 & 가용성의 문제

- T1 : X * 1.01
- T2 : X - 10
- T1 → T2 이나, T1이 네트워크 장애로 수행 여부를 판단하지 못할 때 T2는 수행되어야 하는가
    - 수행하지 않는 경우, T2가 운영되지 못함 → 가용성의 문제

### 궁극성(Eventual Consistency) vs 강한 일관성 (Strong Consistency)

Eventual Consistency 

- 가용성을 포기하지 않고, 언젠가의 동기화를 통한 Consistency 유지
- 동기화 주기 내에는 Consistency가 유지되지 않고, 유지하기 어려움.
![img.png](4장%20CAP,%20FLP%20정리/img.png)
[https://www.acodersjourney.com/eventual-consistency/](https://www.acodersjourney.com/eventual-consistency/)

Strong Consistency : 서버간 데이터를 복사할 때 동시성을 제어함

- Locking [v]

# 4.2. Consensus

## 내용

복제 상태 : 동일한 정보를 보는지에 대한 여부

### 합의 조건

| 항목 |  |  |  |  |
| --- | --- | --- | --- | --- |
| 종결 |  |  |  |  |
| 동의 |  |  |  |  |
| 타당성 |  |  |  |  |

# 4.3. FLP 정리

문제 상황: 분산 장치 중 일부가 응답을 하지 않을 때, 합의할 수 있는 알고리즘 존재?

~= P를 유지하기 위해 C나 A를 일부 희생하는 알고리즘 존재?

FLP 정리 가정 

- 장애를 겪지 않은 장치들은 합의에 도달해야 함.
    - 장애를 겪는다 : 자신의 상태를 알리지 못하는 경우
    - 장애를 겪는 장치의 발생 유무에 따라 결과가 달라짐 → Non-deterministic함.
- 증명 : 노드의 상태를 bi-valent(bivalence) 상태로 가정.
    - bi-valent: 상태에서 두 가지 결론이 날 수 있음 (0, 1)
    - uni-valent: 모든 가능한 실행 경로가 동일한 결정 값을 냄.
- 그래서 이 얘기가 왜 나온건데? → 이는 FLP 정리를 증명하기 위한 수단
    
    증명 과정 : [https://homepage.divms.uiowa.edu/~ghosh/16612.week11.pdf](https://homepage.divms.uiowa.edu/~ghosh/16612.week11.pdf)
    
    ### **증명 과정**
    
    1. **보조정리 1**: 0-일분 상태에서 1-일분 상태로 전환하는 실행은 불가능합니다.
        - **설명**: 만약 0-일분 상태에서 1-일분 상태로 전환할 수 있다면, 이는 같은 초기 조건에서 두 가지 다른 결정을 내릴 수 있음을 의미하므로 모순이 발생합니다.
    2. **보조정리 2**: 모든 합의 프로토콜은 반드시 이분 초기 상태를 가집니다.
        - **증명**: 초기 상태가 모두 0-일분 상태 또는 1-일분 상태라면, 초기 입력 값이 달라질 때 특정 프로세스의 고장에 따라 이분 상태로 전환될 수 있습니다.
    3. **주장**: 합의 프로토콜에서, 이분 초기 상태로부터 시작하여, 특정 프로세스가 행동을 취할 때마다 0-일분 또는 1-일분 상태로 전환되는 상태 T가 존재해야 합니다.
        - **증명**: 모든 행동이 특정 값으로 결정되는 상태 T가 반드시 존재해야 하며, 이러한 상태가 존재하지 않으면 합의에 도달할 수 없습니다.
    4. **결론**: 순수 비동기 시스템에서 하나의 프로세스가 고장나면 합의 문제는 해결될 수 없습니다.

# 4.4. 무결한 프로세스간의 합의

무결한 프로세스 : 중간에 동작이 중단되지 않고 반드시 메시지를 주고받는 프로세스

### 정족수 충족 합의

무결 프로세스 → 이웃 프로세스에 역할 하는지 확인